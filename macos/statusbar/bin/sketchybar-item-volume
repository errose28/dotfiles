#!/usr/bin/env sh

(
flock --nonblock 200 || exit 1

icon_font_size=20

if m volume ismute | grep -q true; then
    label=''
    icon=ﱝ
else
    icon=墳
    label="$(m volume | awk '{print $2}')%"
    if echo "$label" | grep -q 'missing'; then
        # Case for external audio device.
        label=''
    fi
    # Todo: lower level icon: icon=奔
fi

NAME=volume \
SCRIPT='sketchybar-item-volume' \
UPDATE_FREQ=1 \
LABEL="$label" \
ICON_FONT_SIZE="$icon_font_size" \
ICON="$icon" \
sketchybar-add-item
) 200>/tmp/sketchybar-volume.lock

