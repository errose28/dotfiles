#!/usr/bin/env sh

# Path to qcow2 or other image format (not the iso)
img_file="$1"

# Path to ISO. Only necessary on first run.
iso_file="$2"
cdrom=''
if [ "$iso_file" ]; then
    cdrom="-boot d -cdrom "$iso_file""
fi

qemu-system-x86_64 \
-cpu host \
-enable-kvm \
-m 4G \
-smp 4 \
-nic user,model=virtio \
-drive file="$img_file",media=disk,if=virtio \
-vga qxl \
-usb -device usb-tablet \
-bios /usr/share/edk2-ovmf/x64/OVMF_CODE.fd \
$cdrom

# OPTIONS EXPLANATION:
# Emulate host CPU for better performance.
# -cpu host \
# Amount of RAM.
# -m 2G \
# Number of cores to use.
# -smp 4 \
# Network controller.
# -nic user,model=virtio \
# -drive file="$img_file",media=disk,if=virtio \
# Graphics driver.
# -vga qxl \
# Better support for moving mouse in and out of VM.
# -usb -device usb-tablet \
# Uncomment and replace with iso to install for first time.
#-cdrom ubuntu-20.04.1-desktop-amd64.iso \
